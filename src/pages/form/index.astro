---
import { Image } from 'astro:assets';
import Flex from 'src/shared/ui/Flex.astro';
import FormLayout from '../../layouts/FormLayout.astro';
---

<FormLayout title='Отправить данные'>
	<Flex
		className='gform flex flex-col  w-full p-4 md:p-8 lg:p-12 shadow-lg rounded-2xl bg-secondary-bg/15 border-2 border-secondary-bg'>
		<form
			class='gform max-w-[750px] flex flex-col w-full gap-8 md:gap-12 lg:gap-16'
			method='post'
			enctype='application/x-www-form-urlencoded'
			id='contactForm'>
			<h1 class='text-2xl md:text-4xl'>Отправьте номер телефона и мы с Вами свяжемся</h1>
			<div class='flex flex-col'>
				<label>{'Номер телефона'}</label>
				<input
					class='p-4 md:p-5 rounded-2xl border border-accent-secondary'
					type='text'
					value=''
					name='phone'
					id='maskedInput'
					required
					placeholder='+7 (___)___-__-__'
				/>
			</div>
			<button
				id='myButton'
				onclick='disableButton()'
				type='submit'
				class='text-white button bg-accent rounded-full px-8 py-4 hover:bg-accent-secondary'>
				{'Заказать звонок'}
			</button>
			<div
				class='hidden'
				id='thankyou_message'>
				<h2 class='flex flex-col'>
					<em class='text bold'>Спасибо что выбрали нас!</em> Наши сотрудники свяжутся с вами
					в ближайшее время.
				</h2>
			</div>
		</form>
		<div class='mx-auto w-full h-full p-4 md:p-8 lg:p-12'>
			<Image
				class={'object-contain min-w-[250px] mx-auto'}
				src={'/испуганный таракан.webp'}
				alt={''}
				height={'600'}
				width={'600'}
			/>
		</div>
	</Flex>

	<script is:inline>
		const responseContainer = document.getElementById('thankyou_message');
		document.getElementById('contactForm').addEventListener('submit', function (e) {
			e.preventDefault(); // Предотвращаем стандартную отправку формы

			const formData = new FormData(this); // Собираем данные формы
			console.log(formData);
			// Находим кнопку отправки в форме
			const submitButton = this.querySelector('button[type="submit"], input[type="submit"]');
			// Отключаем кнопку, чтобы предотвратить повторную отправку
			if (submitButton) {
				submitButton.disabled = true;
			}

			// Отправляем данные формы асинхронно
			fetch('../sendmail.php', {
				method: 'POST',
				body: formData,
			})
				.then(() => (this.disabled = true))
				.then(() => {
					// Обрабатываем ответ от сервера
					// responseContainer.textContent = 'Ваше сообщение отправлено!';
					responseContainer.classList.remove('hidden');
					responseContainer.style = 'color: green;';
					// alert(data); // Можно заменить на более красивое отображение сообщения
					this.reset();
				})
				.catch(error => {
					console.error('Error:', error);
					responseContainer.textContent =
						'Произошла ошибка. Ваше сообщение не было отправлено! Рекомендуем позвонить нам по телефону.';
					responseContainer.classList.remove('hidden');
					responseContainer.style = 'color: red;';
					alert('Произошла ошибка при отправке формы'); // Можно заменить на более красивое отображение сообщения об ошибке
					// Включаем кнопку обратно, чтобы пользователь мог попробовать отправить форму снова
					if (submitButton) {
						submitButton.disabled = false;
					}
				});
		});
	</script>
</FormLayout>

<style>
	button:disabled {
		background-color: gray;
		pointer-events: none;
	}
</style>
